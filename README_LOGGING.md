# Система логирования WPNCollector

## Обзор

В приложение WPNCollector добавлена комплексная система логирования, которая обеспечивает:

- **Многоуровневое логирование** (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- **Многопотоковое логирование** с информацией о процессах и потоках
- **Ротацию файлов** по размеру и времени
- **Цветной вывод** в консоль для удобства чтения
- **Отдельные файлы** для ошибок и ежедневных логов
- **Настраиваемые уровни** логирования для консоли и файлов

## Структура файлов логов

```
logs/
├── WPNCollector.log          # Основной лог (ротация по размеру)
├── WPNCollector_daily.log    # Ежедневный лог (ротация по дням)
├── WPNCollector_errors.log   # Лог ошибок (только ERROR и выше)
├── MainProcess.log           # Логи основного процесса
├── OpenTables.log            # Логи модуля открытия таблиц
├── CloseTables.log           # Логи модуля закрытия таблиц
└── GoogleDrive.log           # Логи Google Drive модуля
```

## Конфигурация

Настройки логирования находятся в файле `config.py`:

```python
'logging': {
    'level': logging.INFO,           # Общий уровень логирования
    'console_level': logging.INFO,   # Уровень для консоли
    'file_level': logging.DEBUG,     # Уровень для файлов
    'max_file_size_mb': 10,          # Максимальный размер файла лога
    'backup_count': 5,               # Количество резервных файлов
    'daily_backup_count': 30,        # Количество ежедневных резервных файлов
    'error_file_size_mb': 5,         # Максимальный размер файла ошибок
    'error_backup_count': 3          # Количество резервных файлов ошибок
}
```

## Использование

### Базовое логирование

```python
from logger import get_logger

# Получить логгер для модуля
logger = get_logger('MyModule')

# Логирование разных уровней
logger.debug('Отладочная информация')
logger.info('Информационное сообщение')
logger.warning('Предупреждение')
logger.error('Ошибка')
logger.critical('Критическая ошибка')
```

### Логирование в основных модулях

Все основные модули уже настроены с логированием:

- **MainProcess** - основной процесс и управление процессами
- **OpenTables** - открытие покерных таблиц
- **CloseTables** - закрытие покерных таблиц  
- **GoogleDrive** - загрузка файлов в Google Drive

### Утилиты логирования

#### Декораторы

```python
from log_utils import log_function_call, log_execution_time, log_performance

@log_function_call('MyModule')
def my_function(x, y):
    return x + y

@log_execution_time('MyModule', 'INFO')
def slow_function():
    time.sleep(1)
    return "done"

@log_performance
def memory_intensive():
    data = [i for i in range(100000)]
    return len(data)
```

#### Контекстный менеджер

```python
from log_utils import LogContext

with LogContext("Обработка турнира", 'OpenTables', 'INFO'):
    # Код обработки турнира
    process_tournament(tournament)
    logger.info("Турнир обработан успешно")
```

## Уровни логирования

### DEBUG
- Детальная информация для отладки
- Вызовы функций с аргументами
- Состояние внутренних переменных
- Время выполнения операций

### INFO  
- Основные события приложения
- Запуск/остановка процессов
- Обработка турниров и таблиц
- Успешные операции

### WARNING
- Предупреждения о потенциальных проблемах
- Повторные попытки операций
- Неожиданные, но некритичные ситуации

### ERROR
- Ошибки, которые не останавливают работу
- Проблемы с отдельными турнирами/таблицами
- Сетевые ошибки
- Проблемы с файлами

### CRITICAL
- Критические ошибки, останавливающие работу
- Проблемы с основными процессами
- Недоступность критических ресурсов

## Формат логов

### Консольный вывод
```
12:34:56 | INFO     | [MainProcess:MainThread] | MainProcess | <module>:15 | Запуск приложения WPNCollector
```

### Файловый вывод
```
2024-01-15 12:34:56 | INFO     | [MainProcess:MainThread] | MainProcess | <module>:15 | Запуск приложения WPNCollector
```

## Мониторинг и анализ

### Просмотр логов в реальном времени

```bash
# Основной лог
tail -f logs/WPNCollector.log

# Лог ошибок
tail -f logs/WPNCollector_errors.log

# Лог конкретного модуля
tail -f logs/OpenTables.log
```

### Поиск по логам

```bash
# Поиск ошибок
grep "ERROR" logs/*.log

# Поиск по конкретному турниру
grep "Tournament ID: 12345" logs/*.log

# Поиск по времени
grep "2024-01-15 12:" logs/*.log
```

### Анализ производительности

```bash
# Время выполнения функций
grep "выполнена за" logs/*.log | sort

# Использование памяти
grep "память=" logs/*.log
```

## Рекомендации

### Для разработчиков

1. **Используйте правильные уровни логирования**
   - DEBUG для детальной отладки
   - INFO для основных событий
   - ERROR для ошибок

2. **Добавляйте контекстную информацию**
   - ID турниров и таблиц
   - Время выполнения операций
   - Размеры файлов и данных

3. **Логируйте исключения полностью**
   - Используйте `traceback.format_exc()`
   - Включайте контекст ошибки

### Для операторов

1. **Мониторьте файлы ошибок**
   - Регулярно проверяйте `*_errors.log`
   - Настройте алерты на критические ошибки

2. **Анализируйте производительность**
   - Отслеживайте время выполнения операций
   - Мониторьте использование ресурсов

3. **Ротация логов**
   - Логи автоматически ротируются
   - Старые файлы сохраняются в архиве

## Устранение неполадок

### Проблемы с логированием

1. **Логи не создаются**
   - Проверьте права доступа к директории `logs/`
   - Убедитесь, что импорт `logger` корректен

2. **Слишком много логов**
   - Увеличьте уровень логирования в конфиге
   - Настройте фильтры для конкретных модулей

3. **Логи не ротируются**
   - Проверьте настройки размера файлов
   - Убедитесь, что есть права на создание новых файлов

### Отладка

```python
# Включить отладочное логирование
import logging
logging.getLogger('WPNCollector').setLevel(logging.DEBUG)

# Проверить настройки логгера
logger = get_logger('Test')
print(logger.level)
print(logger.handlers)
``` 